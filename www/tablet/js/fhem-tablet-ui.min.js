"use strict";function onjQueryLoaded(){ftui.init(),$(".menu").on("click",function(){$(".menu").toggleClass("show")}),$(window).on("beforeunload",function(){ftui.log(5,"beforeunload"),ftui.setOffline()}),$(window).on("online offline",function(){ftui.log(5,"online offline"),navigator.onLine?ftui.setOnline():ftui.setOffline()}),window.onerror=function(t,e,i,n,o){var a=e.split("/").pop();return ftui.toast([a+":"+i,o].join("<br/>"),"error"),!1},$.fn.once=function(t,e){return this.each(function(){$(this).off(t).on(t,e)})},$.fn.widgetId=function(){return["ftui",$(this).data("type"),$(this).data("device"),$(this).data("get")].join("_")},$.fn.filterData=function(t,e){return this.filter(function(){return $(this).data(t)==e})},$.fn.filterDeviceReading=function(t,e,i){return this.filter(function(){var n=$(this),o=n.data(t);return String(o)===i&&String(n.data("device"))===e||o===e+":"+i||$.inArray(i,o)>-1&&String(n.data("device"))===e||$.inArray(e+":"+i,o)>-1})},$.fn.isValidData=function(t){return"undefined"!=typeof $(this).data(t)},$.fn.initData=function(t,e){var i=$(this);return i.data(t,i.isValidData(t)?i.data(t):e),i},$.fn.mappedColor=function(t){return ftui.getStyle("."+$(this).data(t),"color")||$(this).data(t)},$.fn.matchingState=function(t,e){if(!ftui.isValid(e))return"";var i=String(ftui.getPart(e,$(this).data(t+"-part"))),n=$(this).data(t+"-on"),o=$(this).data(t+"-off"),a=String(n),r=String(o);if(ftui.isValid(n)){if(i===a)return"on";if(i.match(new RegExp("^"+a+"$")))return"on"}if(ftui.isValid(o)){if(i===r)return"off";if(i.match(new RegExp("^"+r+"$")))return"off"}if(ftui.isValid(n)&&ftui.isValid(o)){if("!off"===a&&i!==r)return"on";if("!on"===r&&i!==a)return"off"}},$.fn.isDeviceReading=function(t){var e=$(this).data(t);return e&&!$.isNumeric(e)&&e.match(/:/)},$.fn.isExternData=function(t){var e=$(this).data(t);return e?e.match(/^[#\.\[].*/):""},$.fn.getReading=function(t,e){var i=String($(this).data("device")),n=$(this).data(t);if($.isArray(n)&&(n=n[e]),n=String(n),n&&n.match(/:/)){var o=n.split(":");i=o[0],n=o[1]}if(i&&i.length>0){var a=ftui.deviceStates[i];return a&&a[n]?a[n]:{}}return{}},$.fn.valOfData=function(t){var e=$(this).data(t);return ftui.isValid(e)?e.toString().match(/^[#\.\[].*/)?$(e).data("value"):e:""},$.fn.transmitCommand=function(){if(!$(this).hasClass("notransmit")){var t=[$(this).valOfData("cmd"),$(this).valOfData("device"),$(this).valOfData("set"),$(this).valOfData("value")].join(" ");ftui.setFhemStatus(t),ftui.toast(t)}}}if("function"==typeof Framework7){var f7={ftui:new Framework7({animateNavBackIcon:!0}),options:{dynamicNavbar:!0,domCache:!0},views:[]};$(".view").each(function(t){var e=f7.ftui.addView("#"+$(this)[0].id,{dynamicNavbar:!0});f7.ftui.views.push(e)}),f7.ftui.onPageInit("*",function(t){ftui.log(t.name+" initialized"),ftui.initWidgets('[data-page="'+t.name+'"]')})}var Modul_widget=function(){function update_lock(t,e){me.elements.filterDeviceReading("lock",t,e).each(function(t){var e=$(this),i=e.getReading("lock").val;"on"===e.matchingState("lock",i)&&e.addClass("lock"),"off"===e.matchingState("lock",i)&&e.removeClass("lock")})}function update_hide(t,e){me.elements.filterDeviceReading("hide",t,e).each(function(t){var e=$(this),i=e.getReading("hide").val;"on"===e.matchingState("hide",i)&&(ftui.isValid(e.data("hideparents"))?e.parents(e.data("hideparents")).hide():e.hide()),"off"===e.matchingState("hide",i)&&(ftui.isValid(e.data("hideparents"))?e.parents(e.data("hideparents")).show():e.show())})}function update_reachable(t,e){me.elements.filterDeviceReading("reachable",t,e).each(function(t){var e=$(this),i=e.getReading("reachable").val;"on"===e.matchingState("reachable",i)&&e.removeClass("unreachable"),"off"===e.matchingState("reachable",i)&&e.addClass("unreachable")})}function substitution(value,subst){if(ftui.isValid(subst))if($.isArray(subst)){for(var i=0,len=subst.length;len>i;i+=2)if(value==subst[i]&&len>i+1)return subst[i+1]}else{if(subst.match(/^s/)){var f=subst.substr(1,1),sub=subst.split(f);return value.replace(new RegExp(sub[1],sub[3]),sub[2])}if(subst.match(/weekdayshort/))return ftui.dateFromString(value).ee();if(subst.match(/.*\(\)/))return eval("value."+subst)}return value}function fix(t,e){return $.isNumeric(t)&&e>=0?Number(t).toFixed(e):t}function map(t,e,i){if("object"==typeof t&&null!==t)for(var n in t)if(e===n||e.match(new RegExp("^"+n+"$")))return t[n];return i}function init_attr(t){}function init_ui(t){t.text(me.widgetname)}function init(){ftui.log(1,"init widget: name="+me.widgetname+" area="+me.area),me.elements=$('[data-type="'+me.widgetname+'"]',me.area),me.elements.each(function(t){me.init_attr($(this)),me.init_ui($(this))})}function addReading(t,e){var i=t.data(e);if(ftui.isValid(i)&&($.isArray(i)||!i.toString().match(/^[#\.\[].*/))){var n=t.data("device");$.isArray(i)||(i=new Array(i.toString()));for(var o=0,a=i.length;a>o;o++){var r=i[o];if(r.match(/:/)){var s=r.split(":");n=s[0],r=s[1]}if(ftui.isValid(n)&&ftui.isValid(r)){n=n.toString();var l="STATE"===r?n:[n,r].join("-");subscriptions[l]={},subscriptions[l].device=n,subscriptions[l].reading=r}}}}function update(t,e){ftui.log(1,"warning: "+me.widgetname+" has not implemented update function")}var subscriptions={},elements,me={widgetname:"widget",area:"",init:init,init_attr:init_attr,init_ui:init_ui,update:update,update_lock:update_lock,update_reachable:update_reachable,update_hide:update_hide,substitution:substitution,fix:fix,map:map,addReading:addReading,subscriptions:subscriptions,elements:elements};return me},plugins={modules:[],addModule:function(t){this.modules.push(t)},removeArea:function(t){for(var e=this.modules.length-1;e>=0;e-=1)this.modules[e].area===t&&this.modules.splice(e,1)},updateParameters:function(){ftui.subscriptions={},ftui.subscriptionTs={},ftui.devs=[];for(var t=this.modules.length-1;t>=0;t-=1){var e=this.modules[t];for(var i in e.subscriptions){ftui.subscriptions[i]=e.subscriptions[i],ftui.subscriptionTs[i+"-ts"]=e.subscriptions[i];var n=ftui.subscriptions[i].device;ftui.devs.indexOf(n)<0&&ftui.devs.push(n)}}ftui.states.lastShortpoll=0},load:function(t,e){return ftui.log(1,"Load widget : "+t),ftui.loadPlugin(t,e)},update:function(t,e){$.each(this.modules,function(i,n){"object"==typeof n&&n.update(t,e)}),ftui.log(1,'update done for "'+t+":"+e+'"')}},ftui={version:"2.5.1",config:{DEBUG:!1,DEMO:!1,dir:"",filename:"",fhem_dir:"",debuglevel:0,doLongPoll:1,lang:"de",shortpollInterval:0,styleCollection:{},stdColors:["green","orange","red","ligthblue","blue","gray","white","mint"]},poll:{currLine:0,xhr:null,longPollRequest:null,shortPollTimer:null,longPollTimer:null,timestamp:"01.01.1970"},states:{lastSetOnline:0,lastShortpoll:0,longPollRestart:!1},deviceStates:{},paramIdMap:{},timestampMap:{},subscriptions:{},subscriptionTs:{},gridster:{instances:{},instance:null,baseX:0,baseY:0,margins:5,mincols:0,cols:0,rows:0},init:function(){function i(){$.toast&&!$('link[href="lib/jquery.toast.min.css"]').length&&$("head").append('<link rel="stylesheet" href="lib/jquery.toast.min.css" type="text/css" />')}ftui.paramIdMap={},ftui.timestampMap={},ftui.config.doLongPoll=$("meta[name='longpoll']").attr("content")||1,ftui.config.longPollFilter=$("meta[name='longpoll_filter']").attr("content")||".*",ftui.config.DEMO="1"==$("meta[name='demo']").attr("content"),ftui.config.debuglevel=$("meta[name='debug']").attr("content")||0,ftui.config.DEBUG=ftui.config.debuglevel>0,ftui.config.TOAST=$("meta[name='toast']").attr("content")||5,ftui.config.shortpollInterval=$("meta[name='shortpoll-only-interval']").attr("content")||30;var t=window.location.pathname;ftui.config.filename=t.substring(t.lastIndexOf("/")+1),ftui.log(1,"Filename: "+ftui.config.filename),ftui.config.fhem_dir=$("meta[name='fhemweb_url']").attr("content")||"/fhem/",ftui.log(1,"FHEM dir: "+ftui.config.fhem_dir);var e=navigator.language||navigator.userLanguage;ftui.config.lang=$("meta[name='lang']").attr("content")||ftui.isValid(e)?e.split("-")[0]:"de",$.fn.toast?i():ftui.dynamicload("lib/jquery.toast.min.js",!1).done(function(){i()});try{localStorage.setItem("ftui",ftui.version),localStorage.removeItem("ftui")}catch(n){ftui.toast("You are in Privacy Mode<br>Please deactivate Privacy Mode and then reload the page.","error")}$("<div id='shade' />").prependTo("body").hide();var o=ftui.getAndroidVersion(),a=o&&parseFloat(o)<5,r=a?"touchstart":"touchstart mousedown";if($("#shade").on(r,function(t){$(document).trigger("shadeClicked")}),ftui.readStatesLocal(),0===$('link[href*="fhem-tablet-ui.css"]').length&&0===$('link[href*="fhem-tablet-ui.min.css"]').length){var s="css/fhem-tablet-ui.css";$.when($.get(s,function(){$("<link>",{rel:"stylesheet",type:"text/css",href:s}).prependTo("head")})).then(function(){var t=0,e=setInterval(function(){ftui.log(1,"fhem-tablet-ui.css dynamically loaded. Waiting until it is ready to use..."),"center"===$("body").css("text-align")&&(clearInterval(e),ftui.loadStyleSchema(),ftui.initPage()),t++,t>120&&(clearInterval(e),ftui.toast("fhem-tablet-ui.css not ready to use","error"))},50)})}else ftui.loadStyleSchema(),ftui.initPage();$(document).on("initWidgetsDone",function(){ftui.startShortPollInterval(500),ftui.initHeaderLinks()}),$(document).one("updateDone",function(){ftui.log(2,"document triggered updateDone"),ftui.initLongpoll()}),f7||$("*:not(select):not(textarea)").focus(function(){$(this).blur()}),ftui.config.debuglevel>0&&setInterval(function(){ftui.healthCheck()},6e4)},initGridster:function(t){function e(){ftui.gridster.baseX=parseInt($("meta[name='widget_base_width']").attr("content")||0),ftui.gridster.baseY=parseInt($("meta[name='widget_base_height']").attr("content")||0),ftui.gridster.cols=parseInt($("meta[name='gridster_cols']").attr("content")||0),ftui.gridster.rows=parseInt($("meta[name='gridster_rows']").attr("content")||0),ftui.gridster.resize=parseInt($("meta[name='gridster_resize']").attr("content")||1),$("meta[name='widget_margin']").attr("content")&&(ftui.gridster.margins=parseInt($("meta[name='widget_margin']").attr("content")));var i=-1,n=-1;$(".gridster > ul > li").each(function(){var t=$(this).data("col")+$(this).data("sizex")-1;t>i&&(i=t);var e=$(this).data("row")+$(this).data("sizey")-1;e>n&&(n=e)}),ftui.gridster.cols=ftui.gridster.cols>0?ftui.gridster.cols:i,ftui.gridster.rows=ftui.gridster.rows>0?ftui.gridster.rows:n;var o=2*ftui.gridster.cols*ftui.gridster.margins,a=2*ftui.gridster.rows*ftui.gridster.margins;ftui.gridster.baseX=ftui.gridster.baseX>0?ftui.gridster.baseX:(window.innerWidth-o)/ftui.gridster.cols,ftui.gridster.baseY=ftui.gridster.baseY>0?ftui.gridster.baseY:(window.innerHeight-a)/ftui.gridster.rows,ftui.gridster.mincols=parseInt($("meta[name='widget_min_cols']").attr("content")||ftui.gridster.cols),ftui.gridster.instances[t]&&ftui.gridster.instances[t].destroy(),ftui.gridster.instances[t]=$(".gridster > ul",t).gridster({widget_base_dimensions:[ftui.gridster.baseX,ftui.gridster.baseY],widget_margins:[ftui.gridster.margins,ftui.gridster.margins],draggable:{handle:".gridster li > header"},min_cols:parseInt(ftui.gridster.mincols)}).data("gridster"),ftui.gridster.instances[t]&&("1"==$("meta[name='gridster_disable']").attr("content")&&ftui.gridster.instances[t].disable(),"1"==$("meta[name='gridster_starthidden']").attr("content")&&$(".gridster").hide());var r=$(".gridster > ul > li:has(* .gridster)");r.length>0&&r.css({"background-color":"transparent",margin:"-"+ftui.gridster.margins+"px",width:r.parent().width()-r.position().left,height:"100%"}),$(".gridster > ul > li:has(.center)").addClass("vbox"),$(".gridster > ul > li:has(.vbox)").addClass("vbox"),$(".gridster li > header ~ .hbox:only-of-type").each(function(t){$(this).css({height:"calc(100% - "+$(this).siblings("header").outerHeight()+"px)"})}),ftui.gridster.resize&&$(window).on("resize",function(){e()})}$(".gridster").length>0&&($('link[href="lib/jquery.gridster.min.css"]').length||$("head").append('<link rel="stylesheet" href="lib/jquery.gridster.min.css" type="text/css" />'),$.fn.gridster?e():ftui.dynamicload("lib/jquery.gridster.min.js",!1).done(function(){e()}))},initPage:function(t){t=ftui.isValid(t)?t:"",console.time("initPage"),ftui.log(2,"initPage - area="+t),ftui.initGridster(t);var e=$.map($("[data-template]",t),function(t,e){var i=$(t);return $.get(i.data("template"),{},function(t){var e=i.data("parameter");for(var n in e)t=t.replace(new RegExp(n,"g"),e[n]);i.html(t)})});$.when.apply(this,e).then(function(){ftui.initWidgets(t),ftui.log(1,"init templates - Done")})},initWidgets:function(t){t=ftui.isValid(t)?t:"";var e=[];ftui.log(3,plugins),plugins.removeArea(t),ftui.log(3,plugins),ftui.log(2,"initWidgets - area="+t),$("[data-type]",t).each(function(t){var i=$(this).data("type");e.indexOf(i)<0&&e.push(i)});var i=$.map(e,function(e,i){return plugins.load(e,t)});$.when.apply(this,i).then(function(){plugins.updateParameters(),ftui.log(1,"initWidgets - Done"),console.timeEnd("initPage"),$(document).trigger("initWidgetsDone",[t])})},initHeaderLinks:function(){$("[class*=fa-]").length>0&&!$('link[href="lib/font-awesome.min.css"]').length&&$("head").append('<link rel="stylesheet" href="lib/font-awesome.min.css" type="text/css" />'),$("[class*=oa-]").length>0&&!$('link[href="lib/openautomation.css"]').length&&$("head").append('<link rel="stylesheet" href="lib/openautomation.css" type="text/css" />'),$("[class*=fs-]").length>0&&!$('link[href="lib/fhemSVG.css"]').length&&$("head").append('<link rel="stylesheet" href="lib/fhemSVG.css" type="text/css" />'),$("[class*=mi-]").length>0&&!$('link[href="lib/material-icons.min.css"]').length&&$("head").append('<link rel="stylesheet" href="lib/material-icons.min.css" type="text/css" />')},initLongpoll:function(){if(ftui.log(2,"initLongpoll: "+ftui.config.doLongPoll),ftui.config.doLongPoll){var t=$("meta[name='longpoll-delay']").attr("content");t=$.isNumeric(t)?1e3*t:100,ftui.startLongPollInterval(t)}},startShortPollInterval:function(t){ftui.log(1,"start shortpoll in (ms):"+(t||1e3*ftui.config.shortpollInterval)),clearInterval(ftui.shortPollTimer),ftui.shortPollTimer=setTimeout(function(){ftui.shortPoll(),ftui.startShortPollInterval()},t||1e3*ftui.config.shortpollInterval)},startLongPollInterval:function(t){ftui.config.DEBUG&&t>999&&ftui.toast("Start Longpoll in "+t/1e3+"s"),clearInterval(ftui.longPollTimer),ftui.longPollTimer=setTimeout(function(){ftui.longPoll()},t),ftui.config.shortpollInterval=$("meta[name='shortpoll-interval']").attr("content")||900},shortPoll:function(){var t=(new Date).getTime()/1e3;if(!(t-ftui.states.lastShortpoll<ftui.config.shortpollInterval)){ftui.log(1,"start shortpoll");var e=new Date;for(var i in ftui.deviceStates){var n=ftui.deviceStates[i];for(var o in n)n[o].valid=!1}console.time("get jsonlist2");var a=ftui.isValid(ftui.devs)?$.map(ftui.devs,$.trim).join():".*";$.getJSON(ftui.config.fhem_dir,{cmd:"jsonlist2 "+a,XHR:1,timeout:6e4}).done(function(i){function n(t,e){for(var i in e){var n=!1,o="STATE"===i?t:[t,i].join("-"),a=e[i];if("object"!=typeof a&&(a={Value:a,Time:""}),ftui.subscriptions[o]){var r=ftui.getDeviceParameter(t,i);n=!r||r.val!==a.Value||r.date!==a.Time}var s=ftui.deviceStates[t]||{},l=s[i]||{};l.date=a.Time,l.val=a.Value,l.valid=!0,s[i]=l,ftui.deviceStates[t]=s,ftui.paramIdMap[o]={},ftui.paramIdMap[o].device=t,ftui.paramIdMap[o].reading=i,ftui.timestampMap[o+"-ts"]={},ftui.timestampMap[o+"-ts"].device=t,ftui.timestampMap[o+"-ts"].reading=i,n&&(ftui.log(5,"[shortPoll] do update for "+t+","+i),plugins.update(t,i))}}console.timeEnd("get jsonlist2"),console.time("read jsonlist2"),ftui.log(3,"fhemJSON: 0="+Object.keys(i)[0]+" 1="+Object.keys(i)[1]);var o=i.Results.length;ftui.log(2,"shortpoll: fhemJSON.Results.length="+o);for(var a=i.Results,r=0;o>r;r++){var s=a[r],l=s.Name;0!==l.indexOf("FHEMWEB")&&0!==l.indexOf("WEB_")&&(n(l,s.Readings),n(l,s.Internals),n(l,s.Attributes))}var f=ftui.diffSeconds(e,new Date);if(ftui.config.DEBUG){var u=Object.keys(ftui.paramIdMap).length;ftui.toast("Full refresh done in "+f+"s for "+u+" parameter(s)")}ftui.log(1,"shortPoll - Done"),ftui.states.lastShortpoll=t,ftui.saveStatesLocal(),ftui.onUpdateDone(),console.timeEnd("read jsonlist2")}).fail(function(t,e,i){var n=e+", "+i;ftui.log(1,"shortPoll request failed: "+n),ftui.toast("<u>ShortPoll Request Failed, will retry in 3s</u><br>"+n,"error"),ftui.states.lastSetOnline=0,ftui.states.lastShortpoll=0,ftui.startShortPollInterval(3e3)})}},longPoll:function(){return ftui.config.DEMO?void console.log("DEMO-Mode: no longpoll"):ftui.xhr?void ftui.log(3,"valid ftui.xhr found"):ftui.longPollRequest?void ftui.log(3,"valid ftui.longPollRequest found"):(ftui.poll.currLine=0,ftui.config.DEBUG&&(ftui.states.longPollRestart?ftui.toast("Longpoll re-started"):ftui.toast("Longpoll started")),ftui.log(1,ftui.states.longPollRestart?"Longpoll re-started":"Longpoll started"),ftui.states.longPollRestart=!1,void(ftui.longPollRequest=$.ajax({url:ftui.config.fhem_dir,cache:!1,async:!0,method:"GET",data:{XHR:1,inform:"type=status;filter="+ftui.config.longPollFilter+";fmt=JSON"},xhr:function(){return ftui.xhr=new window.XMLHttpRequest,ftui.xhr.addEventListener("readystatechange",function(t){var e=t.target.responseText;if(4!=t.target.readyState&&3==t.target.readyState){var i=e.split(/\n/);i.pop();for(var n=ftui.poll.currLine,o=i.length;o>n;n++)if(ftui.log(5,i[n]),ftui.isValid(i[n])&&""!==i[n])try{var a=JSON.parse(i[n]),r=null,s=null,l=a[1]!==a[2];ftui.log(4,a);var f=ftui.paramIdMap[a[0]],u=ftui.timestampMap[a[0]];f&&(l&&(f.reading="STATE"),r=ftui.deviceStates[f.device]||{},s=r[f.reading]||{},s.val=a[1],s.valid=!0,r[f.reading]=s,ftui.deviceStates[f.device]=r,l&&ftui.subscriptions[a[0]]&&plugins.update(f.device,f.reading)),u&&!l&&(r=ftui.deviceStates[u.device]||{},s=r[u.reading]||{},s.date=a[1],r[u.reading]=s,ftui.poll.timestamp=s.date,ftui.deviceStates[u.device]=r,ftui.subscriptionTs[a[0]]&&plugins.update(u.device,u.reading))}catch(c){ftui.log(1,"Error: (longpoll) "+c)}ftui.poll.currLine=i.length,ftui.poll.currLine>9999&&(ftui.states.longPollRestart=!0,ftui.longPollRequest.abort())}},!1),ftui.xhr}}).done(function(t){ftui.xhr&&(ftui.xhr.abort(),ftui.xhr=null),ftui.longPollRequest=null,ftui.states.longPollRestart?ftui.longPoll():(ftui.log(1,"Disconnected from FHEM - poll done - "+t),ftui.restartLongPoll())}).fail(function(t,e,i){ftui.xhr&&(ftui.xhr.abort(),ftui.xhr=null),ftui.longPollRequest=null,ftui.states.longPollRestart?ftui.longPoll():(ftui.log(1,"Error while longpoll: "+e+": "+i),ftui.restartLongPoll())})))},setFhemStatus:function(t){return ftui.config.DEMO?void console.log("DEMO-Mode: no setFhemStatus"):(ftui.startShortPollInterval(),t=t.replace("  "," "),ftui.log(1,"send to FHEM: "+t),void $.ajax({async:!0,cache:!1,method:"POST",url:ftui.config.fhem_dir,data:{cmd:t,XHR:"1"}}).fail(function(t,e,i){ftui.toast("<u>FHEM Command Failed</u><br>"+e+": "+i,"error")}))},loadStyleSchema:function(){$.each($('link[href$="-ui.css"],link[href$="-ui.min.css"]'),function(t,e){if(e&&e.sheet&&e.sheet.cssRules){var i=e.sheet.cssRules;for(var n in i)if(i[n].style){var o=i[n].style.cssText.split(";");o.pop();var a=i[n].selectorText,r={};for(var s in o){var l=o[s].toString().split(":");l[0].match(/color/)&&(r[$.trim(l[0])]=$.trim(l[1]).replace("! important","").replace("!important",""))}Object.keys(r).length>0&&(ftui.config.styleCollection[a]=r)}}})},onUpdateDone:function(){$(document).trigger("updateDone"),ftui.checkInvalidElements()},checkInvalidElements:function(){$(".autohide[data-get]").each(function(t){var e=$(this),i=e.getReading("get").valid;i&&i===!0?e.removeClass("invalid"):e.addClass("invalid")})},setOnline:function(){var t=(new Date).getTime()/1e3;t-ftui.states.lastSetOnline>60&&(ftui.config.DEBUG&&ftui.toast("Network connected"),ftui.states.lastSetOnline=t,ftui.states.lastShortpoll=0,ftui.startShortPollInterval(1e3),ftui.config.doLongPoll||(ftui.config.doLongPoll=$("meta[name='longpoll']").attr("content")||1,ftui.config.doLongPoll&&ftui.startLongPollInterval(100)),ftui.log(1,"FTUI is online"))},setOffline:function(){ftui.config.DEBUG&&ftui.toast("Lost network connection"),ftui.config.doLongPoll=0,clearInterval(ftui.shortPollTimer),clearInterval(ftui.longPollTimer),ftui.longPollRequest&&ftui.longPollRequest.abort(),ftui.saveStatesLocal(),ftui.log(1,"FTUI is offline")},readStatesLocal:function(){ftui.config.DEMO?$.ajax({async:!1,method:"GET",url:"/fhem/tablet/data/"+ftui.config.filename.replace(".html",".dat")}).done(function(t){ftui.deviceStates=JSON.parse(t)||{}}):ftui.deviceStates=JSON.parse(localStorage.getItem("deviceStates"))||{}},saveStatesLocal:function(){var t=JSON.stringify(ftui.deviceStates);localStorage.setItem("deviceStates",t),localStorage.setItem("shortPollDuration",ftui.poll.shortPollDuration)},restartLongPoll:function(){ftui.toast("Disconnected from FHEM"),ftui.config.doLongPoll&&(ftui.toast("Retry to connect in 10 seconds"),setTimeout(function(){ftui.longPoll()},1e4))},getDeviceParameter:function(t,e){if(t&&t.length>0){var i=ftui.deviceStates[t];return i&&i[e]?i[e]:null}return null},loadPlugin:function(t,e){var i=new $.Deferred;return ftui.log(2,"Create widget : "+t),ftui.dynamicload("js/widget_"+t+".js",!0).done(function(){var n=[],o=window["depends_"+t];if($.isFunction(o)){var a=o();a&&(a=$.isArray(a)?a:[a],$.map(a,function(t,e){t.indexOf(".js")<0?n.push(ftui.loadPlugin(t)):n.push(ftui.dynamicload(t,!1))}))}else ftui.log(2,"function depends_"+t+" not found (maybe ok)");$.when.apply(this,n).always(function(){var n=window["Modul_"+t]?new window["Modul_"+t]:null;if(n){if("undefined"!=typeof e){plugins.addModule(n),ftui.isValid(e)&&(n.area=e),ftui.log(1,"Try to init plugin: "+t),n.init();for(var o in n.subscriptions)n.update(n.subscriptions[o].device,n.subscriptions[o].reading)}ftui.log(1,"Loaded plugin: "+t)}else ftui.log(1,"Failed to create widget: "+t);i.resolve()})}).fail(function(){ftui.toast("Failed to load plugin : "+t),ftui.log(1,"Failed to load plugin : "+t+'  - add <script src="js/widget_'+t+'.js" defer></script> do your page, to see more informations about this failure'),i.resolve()}),i.promise()},dynamicload:function(t,e){ftui.config.DEBUG?!1:!0;ftui.log(3,"dynamic load file:"+t+" / async:"+e);var n=new $.Deferred,o=document.createElement("script");return o.type="text/javascript",o.async=e?!0:!1,o.src=t,o.onload=function(){ftui.log(3,"dynamic load done:"+t),n.resolve()},document.getElementsByTagName("head")[0].appendChild(o),n.promise()},healthCheck:function(){var t=new Date;t.setTime(1e3*ftui.states.lastShortpoll),console.log("--------- start healthCheck --------------"),console.log("now:",new Date),console.log("FTUI version: "+ftui.version),console.log("Longpoll: "+ftui.config.doLongPoll),console.log("Longpoll objects there: "+(ftui.isValid(ftui.longPollRequest)&&ftui.isValid(ftui.xhr))),console.log("Longpoll curent line: "+ftui.poll.currLine),console.log("Longpoll last event before: "+ftui.poll.timestamp.toDate().ago()),console.log("Shortpoll interval: "+ftui.config.shortpollInterval),console.log("Shortpoll last run before: "+t.ago()),console.log("FHEM dev/par count: "+Object.keys(ftui.paramIdMap).length),console.log("FTUI known devices count: "+Object.keys(ftui.deviceStates).length),console.log("Page length: "+$("html").html().length),console.log("Widgets count: "+$("[data-type]").length),console.log("--------- end healthCheck ---------------")},FS20:{dimmerArray:[0,6,12,18,25,31,37,43,50,56,62,68,75,81,87,93,100],dimmerValue:function(t){var e=ftui.indexOfNumeric(this.dimmerArray,t);return e>-1?this.dimmerArray[e]:0}},rgbToHsl:function(t){var e=parseInt(t.substring(0,2),16),i=parseInt(t.substring(2,4),16),n=parseInt(t.substring(4,6),16);e/=255,i/=255,n/=255;var r,s,o=Math.max(e,i,n),a=Math.min(e,i,n),l=(o+a)/2;if(o==a)r=s=0;else{var f=o-a;switch(s=l>.5?f/(2-o-a):f/(o+a),o){case e:r=(i-n)/f+(n>i?6:0);break;case i:r=(n-e)/f+2;break;case n:r=(e-i)/f+4}r/=6}return[r,s,l]},hslToRgb:function(t,e,i){var n,o,a,s,r=function(t){return("0"+parseInt(t).toString(16)).slice(-2)};if(0===e)n=o=a=i;else{s=function(t,e,i){return 0>i&&(i+=1),i>1&&(i-=1),1/6>i?t+6*(e-t)*i:.5>i?e:2/3>i?t+(e-t)*(2/3-i)*6:t};var l=.5>i?i*(1+e):i+e-i*e,f=2*i-l;n=s(f,l,t+1/3),o=s(f,l,t),a=s(f,l,t-1/3)}return[r(Math.round(255*n)),r(Math.round(255*o)),r(Math.round(255*a))].join("")},rgbToHex:function(t){var e=t.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);return e&&4===e.length?"#"+("0"+parseInt(e[1],10).toString(16)).slice(-2)+("0"+parseInt(e[2],10).toString(16)).slice(-2)+("0"+parseInt(e[3],10).toString(16)).slice(-2):t},getGradientColor:function(t,e,i){t=this.rgbToHex(t).replace(/^\s*#|\s*$/g,""),e=this.rgbToHex(e).replace(/^\s*#|\s*$/g,""),3==t.length&&(t=t.replace(/(.)/g,"$1$1")),3==e.length&&(e=e.replace(/(.)/g,"$1$1"));var n=parseInt(t.substr(0,2),16),o=parseInt(t.substr(2,2),16),a=parseInt(t.substr(4,2),16),r=parseInt(e.substr(0,2),16),s=parseInt(e.substr(2,2),16),l=parseInt(e.substr(4,2),16),f=r-n,u=s-o,c=l-a;return f=(f*i+n).toString(16).split(".")[0],u=(u*i+o).toString(16).split(".")[0],c=(c*i+a).toString(16).split(".")[0],1==f.length&&(f="0"+f),1==u.length&&(u="0"+u),1==c.length&&(c="0"+c),"#"+f+u+c},getPart:function(t,e){if(ftui.isValid(e)){if($.isNumeric(e)){var i=ftui.isValid(t)?t.toString().split(" "):"";return i.length>=e&&e>0?i[e-1]:t}var n="";if(ftui.isValid(t)){var o=t.match(new RegExp("^"+e+"$"));if(o)for(var a=1,r=o.length;r>a;a++)n+=o[a]}return n}return t},showModal:function(t){t?$("#shade").fadeIn():$("#shade").fadeOut()},precision:function(t){var e=t+"",i=e.indexOf(".")+1;return i?e.length-i:0},indexOfGeneric:function(t,e){if(!t)return-1;for(var i=0,n=t.length;n>i;i++)if(!$.isNumeric(t[i]))return ftui.indexOfRegex(t,e);return ftui.indexOfNumeric(t,e)},indexOfNumeric:function(t,e){for(var i=-1,n=0,o=t.length;o>n;n++)Number(e)>=Number(t[n])&&(i=n);return i},indexOfRegex:function(t,e){for(var i=0,n=t.length;n>i;i++)try{var o=e.match(new RegExp("^"+t[i]+"$"));if(o)return i}catch(a){}return t.indexOf(e)},isValid:function(t){return"undefined"!=typeof t&&void 0!==t&&typeof t!=typeof notusedvar},dateFromString:function(t){var e=t.match(/(\d+)-(\d+)-(\d+)[_\s](\d+):(\d+):(\d+).*/),i=t.match(/(\d\d).(\d\d).(\d\d\d\d)/),n=(new Date).getTimezoneOffset();return e?new Date(+e[1],+e[2]-1,+e[3],+e[4],+e[5],+e[6]):i?new Date(+i[3],+i[2]-1,+i[1],0,-n,0,0):new Date},diffMinutes:function(t,e){var i=new Date(e-t);return(i/1e3/60).toFixed(0)},diffSeconds:function(t,e){var i=new Date(e-t);return(i/1e3).toFixed(1)},durationFromSeconds:function(t){var e=Math.floor(t/3600),i=Math.floor(t%3600/60),n=t%60,o="";return e>0&&(o+=""+e+":"+(10>i?"0":"")),o+=""+i+":"+(10>n?"0":""),o+=""+n},mapColor:function(t){return ftui.getStyle("."+t,"color")||t},parseJsonFromString:function(t){return JSON.parse(t)},getAndroidVersion:function(t){t=(t||navigator.userAgent).toLowerCase();var e=t.match(/android\s([0-9\.]*)/);return e?e[1]:!1},getStyle:function(t,e){var i=ftui.config.styleCollection[t];return i&&i[e]?i[e]:null},getClassColor:function(t){for(var e=0,i=ftui.config.stdColors.length;i>e;e++)if(t.hasClass(ftui.config.stdColors[e]))return ftui.getStyle("."+ftui.config.stdColors[e],"color");return null},getIconId:function(t){if(!t||""===t||!$('link[href="lib/font-awesome.min.css"]').length)return"?";var e=$('link[href="lib/font-awesome.min.css"]')[0];if(e&&e.sheet&&e.sheet.cssRules){var i=e.sheet.cssRules;for(var n in i)if(i[n].selectorText&&i[n].selectorText.match(new RegExp(t+":"))){var o=i[n].style.content;return o?(o=o.replace(/"/g,"").replace(/'/g,""),/[^\u0000-\u00ff]/.test(o)?o:String.fromCharCode(parseInt(o.replace("\\",""),16))):t}}},toast:function(t,e){if(0!==ftui.config.TOAST){var i=ftui.config.TOAST;1==ftui.config.TOAST&&(i=!1),e&&"error"===e?f7?f7.ftui.addNotification({title:"FTUI",message:t,hold:1500}):$.toast&&$.toast({heading:"Error",text:t,hideAfter:2e4,icon:"error",loader:!1,stack:i}):f7?f7.ftui.addNotification({title:"FTUI",message:t,hold:1500}):$.toast&&$.toast({text:t,loader:!1,stack:i})}},log:function(t,e){ftui.config.debuglevel>=t&&console.log(e)}};if(String.prototype.toDate=function(){return ftui.dateFromString(this)},String.prototype.parseJson=function(){return ftui.parseJsonFromString(this)},String.prototype.toMinFromSec=function(){var t=Number(this),e=Math.floor(t%60).toString(),i=Math.floor(t/=60).toString();return i+":"+(e[1]?e:"0"+e[0])},String.prototype.toHoursFromSec=function(){var t=Number(this),e=Math.floor(t/3600).toString(),i=Math.floor(t%60).toString(),n=(Math.floor(t/60)-60*e).toString();return e+":"+(n[1]?n:"0"+n[0])+":"+(i[1]?i:"0"+i[0])},Date.prototype.addMinutes=function(t){return new Date(this.getTime()+6e4*t)},Date.prototype.ago=function(t){var e=new Date,i=e-this,n=i/1e3,o=Math.floor(n%60);n/=60;var a=Math.floor(n%60);n/=60;var r=Math.floor(n%24);n/=24;var f,s=Math.floor(n),l="de"===ftui.config.lang?["Tag(e)","Stunde(n)","Minute(n)","Sekunde(n)"]:["day(s)","hour(s)","minute(s)","second(s)"];return ftui.isValid(t)?(f=t.replace("dd",s),f=f.replace("hh",r>9?r:"0"+r),f=f.replace("mm",a>9?a:"0"+a),f=f.replace("ss",o>9?o:"0"+o),f=f.replace("h",r),f=f.replace("m",a),f=f.replace("s",o)):(f=s>0?s+" "+l[0]+" ":"",f+=r>0?r+" "+l[1]+" ":"",f+=a>0?a+" "+l[2]+" ":"",f+=o+" "+l[3]),f},Date.prototype.yyyymmdd=function(){var t=this.getFullYear().toString(),e=(this.getMonth()+1).toString(),i=this.getDate().toString();return t+"-"+(e[1]?e:"0"+e[0])+"-"+(i[1]?i:"0"+i[0])},Date.prototype.hhmm=function(){var t=this.getHours().toString(),e=this.getMinutes().toString();return(t[1]?t:"0"+t[0])+":"+(e[1]?e:"0"+e[0])},Date.prototype.hhmmss=function(){var t=this.getHours().toString(),e=this.getMinutes().toString(),i=this.getSeconds().toString();return(t[1]?t:"0"+t[0])+":"+(e[1]?e:"0"+e[0])+":"+(i[1]?i:"0"+i[0])},Date.prototype.ddmm=function(){var t=(this.getMonth()+1).toString(),e=this.getDate().toString();return(e[1]?e:"0"+e[0])+"."+(t[1]?t:"0"+t[0])+"."},Date.prototype.eeee=function(){var t=["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],e=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];return"de"===ftui.config.lang?t[this.getDay()]:e[this.getDay()]},Date.prototype.eee=function(){var t=["Son","Mon","Die","Mit","Don","Fre","Sam"],e=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return"de"===ftui.config.lang?t[this.getDay()]:e[this.getDay()]},Date.prototype.ee=function(){var t=["So","Mo","Di","Mi","Do","Fr","Sa"],e=["Su","Mo","Tu","We","Th","Fr","Sa"];return"de"===ftui.config.lang?t[this.getDay()]:e[this.getDay()]},ftui.isValid(window.jQuery))$(document).ready(function(){onjQueryLoaded()});else{var script=document.createElement("script");script.type="text/javascript",script.onload=function(){!function(t){t(document).ready(function(){console.log("jQuery dynamically loaded"),onjQueryLoaded()})}(jQuery)},script.src="lib/jquery.min.js",document.getElementsByTagName("head")[0].appendChild(script)}